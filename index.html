<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Datas</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÖ</text></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÖ</text></svg>">
    <!-- Utilizando Tailwind CSS para a estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionais para transi√ß√µes suaves */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feriado-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        }

        .feriado-item:last-child {
            border-bottom: none;
        }

        .feriado-data {
            font-weight: 600;
            white-space: nowrap;
        }

        .feriado-nome {
            text-align: right;
            color: #4338ca;
        }
    </style>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4 font-sans text-slate-800">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden">
        <!-- Cabe√ßalho -->
        <div class="bg-indigo-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                        d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z">
                    </path>
                </svg>
                Calculadora de Datas
            </h1>
            <p class="text-indigo-200 text-sm mt-1">Simples, r√°pida e precisa</p>
        </div>

        <!-- Abas de Navega√ß√£o -->
        <div class="flex border-b border-slate-200">
            <button onclick="switchTab('tab-add')" id="btn-tab-add"
                class="flex-1 py-3 text-sm font-semibold text-indigo-600 border-b-2 border-indigo-600 transition-colors">
                Somar/Subtrair Dias
            </button>
            <button onclick="switchTab('tab-diff')" id="btn-tab-diff"
                class="flex-1 py-3 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-indigo-500 transition-colors">
                Diferen√ßa de Datas
            </button>
        </div>

        <div class="p-6">
            <!-- ABA 1: Somar/Subtrair Dias -->
            <div id="tab-add" class="tab-content active">
                <form id="form-add" onsubmit="event.preventDefault(); calculateFinalDate();" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Data Inicial</label>
                        <input type="date" id="add-start-date" required
                            class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Qtd de Dias</label>
                            <input type="number" id="add-days" required placeholder="Ex: 15 ou -5"
                                class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Tipo de Dia</label>
                            <select id="add-type"
                                class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all bg-white">
                                <option value="corridos">Corridos</option>
                                <option value="uteis">√öteis</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition-colors mt-2">
                        Calcular Data Final
                    </button>
                </form>

                <!-- Resultado Aba 1 -->
                <div id="result-add"
                    class="hidden mt-6 p-4 bg-indigo-50 rounded-lg border border-indigo-100 text-center">
                    <p class="text-sm text-indigo-800 mb-1">A data final ser√°:</p>
                    <p id="result-add-date" class="text-2xl font-bold text-indigo-600"></p>
                    <p id="result-add-detail" class="text-xs text-indigo-500 mt-1"></p>
                    <!-- Feriados do per√≠odo (Aba 1) -->
                    <div id="result-add-feriados" class="hidden mt-4 text-left">
                        <p class="text-xs font-semibold text-indigo-700 uppercase tracking-wide mb-2">üóìÔ∏è Feriados no
                            per√≠odo</p>
                        <div id="result-add-feriados-list" class="text-xs text-slate-700 space-y-0.5"></div>
                    </div>
                </div>
            </div>

            <!-- ABA 2: Diferen√ßa entre Datas -->
            <div id="tab-diff" class="tab-content">
                <form id="form-diff" onsubmit="event.preventDefault(); calculateDateDifference();" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Primeira Data</label>
                        <input type="date" id="diff-date-1" required
                            class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Segunda Data</label>
                        <input type="date" id="diff-date-2" required
                            class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                    </div>

                    <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition-colors mt-2">
                        Calcular Diferen√ßa
                    </button>
                </form>

                <!-- Resultado Aba 2 -->
                <div id="result-diff" class="hidden mt-6 space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100 text-center">
                            <p class="text-xs text-blue-600 uppercase font-semibold tracking-wider">Dias Corridos</p>
                            <p id="result-diff-corridos" class="text-2xl font-bold text-blue-700 mt-1"></p>
                        </div>
                        <div class="p-4 bg-emerald-50 rounded-lg border border-emerald-100 text-center">
                            <p class="text-xs text-emerald-600 uppercase font-semibold tracking-wider">Dias √öteis</p>
                            <p id="result-diff-uteis" class="text-2xl font-bold text-emerald-700 mt-1"></p>
                        </div>
                    </div>
                    <!-- Feriados do per√≠odo (Aba 2) -->
                    <div id="result-diff-feriados" class="hidden p-4 bg-indigo-50 rounded-lg border border-indigo-100">
                        <p class="text-xs font-semibold text-indigo-700 uppercase tracking-wide mb-2">üóìÔ∏è Feriados no
                            per√≠odo</p>
                        <div id="result-diff-feriados-list" class="text-xs text-slate-700 space-y-0.5"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CARREGAMENTO DOS FERIADOS
        // ==========================================
        let feriadosDB = {};

        async function carregarFeriados() {
            try {
                const resp = await fetch('feriados.json');
                feriadosDB = await resp.json();
            } catch (e) {
                console.warn('N√£o foi poss√≠vel carregar feriados.json:', e);
                feriadosDB = {};
            }
        }

        // Converte um Date para string "YYYY-MM-DD" sem problemas de fuso hor√°rio
        function dateToKey(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // Verifica se uma data √© feriado
        function isFeriado(date) {
            return dateToKey(date) in feriadosDB;
        }

        // Retorna os feriados (excluindo finais de semana) entre duas datas (exclusive d1, inclusive d2)
        // Aceita qualquer ordem; internamente garante que a menor data seja o in√≠cio
        function getFeriadosNoPeriodo(d1, d2) {
            let start = new Date(d1);
            let end = new Date(d2);
            if (start > end) { const t = start; start = end; end = t; }

            const result = [];
            // Percorre cada dia do per√≠odo (inclusivo em ambos os lados para a exibi√ß√£o)
            let cur = new Date(start);
            while (cur <= end) {
                const key = dateToKey(cur);
                if (key in feriadosDB) {
                    result.push({ data: new Date(cur), nome: feriadosDB[key] });
                }
                cur.setDate(cur.getDate() + 1);
            }
            return result;
        }

        // Renderiza a lista de feriados em um elemento
        function renderFeriados(containerDivId, listDivId, feriados) {
            const container = document.getElementById(containerDivId);
            const list = document.getElementById(listDivId);
            if (feriados.length === 0) {
                container.classList.add('hidden');
                return;
            }
            list.innerHTML = '';
            feriados.forEach(f => {
                const key = dateToKey(f.data);
                const [y, m, d] = key.split('-');
                const dataFormatada = `${d}/${m}/${y}`;
                const diaSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'][f.data.getDay()];
                const item = document.createElement('div');
                item.className = 'feriado-item';
                item.innerHTML = `<span class="feriado-data text-indigo-800">${dataFormatada} (${diaSemana})</span><span class="feriado-nome">${f.nome}</span>`;
                list.appendChild(item);
            });
            container.classList.remove('hidden');
        }

        // ==========================================
        // INICIALIZA√á√ÉO
        // ==========================================
        window.onload = async () => {
            await carregarFeriados();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('add-start-date').value = today;
            document.getElementById('diff-date-1').value = today;
        };

        // ==========================================
        // NAVEGA√á√ÉO POR ABAS
        // ==========================================
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('btn-tab-add').className = "flex-1 py-3 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-indigo-500 transition-colors";
            document.getElementById('btn-tab-diff').className = "flex-1 py-3 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-indigo-500 transition-colors";

            document.getElementById(tabId).classList.add('active');
            document.getElementById(`btn-${tabId}`).className = "flex-1 py-3 text-sm font-semibold text-indigo-600 border-b-2 border-indigo-600 transition-colors";

            document.getElementById('result-add').classList.add('hidden');
            document.getElementById('result-diff').classList.add('hidden');
        }

        // ==========================================
        // FUN√á√ïES AUXILIARES
        // ==========================================

        // Cria Data de forma segura (evita problema de fuso hor√°rio)
        function parseDate(dateString) {
            const [year, month, day] = dateString.split('-');
            return new Date(year, month - 1, day);
        }

        // Formata data para o padr√£o Brasileiro
        function formatDateBR(date) {
            const diasSemana = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const diaSemana = diasSemana[date.getDay()];
            return { curta: `${day}/${month}/${year}`, longa: diaSemana };
        }

        // Verifica se um dia √© √∫til (n√£o √© fim de semana e n√£o √© feriado)
        function isDiaUtil(date) {
            const dow = date.getDay();
            return dow !== 0 && dow !== 6 && !isFeriado(date);
        }

        // ==========================================
        // ABA 1: Somar/Subtrair Dias
        // ==========================================
        function calculateFinalDate() {
            const startDateStr = document.getElementById('add-start-date').value;
            const daysToAdd = parseInt(document.getElementById('add-days').value);
            const calcType = document.getElementById('add-type').value;

            if (!startDateStr || isNaN(daysToAdd)) return;

            const startDate = parseDate(startDateStr);
            let currentDate = parseDate(startDateStr);
            let addedDays = 0;
            const step = daysToAdd >= 0 ? 1 : -1;
            const absDays = Math.abs(daysToAdd);

            if (calcType === 'corridos') {
                currentDate.setDate(currentDate.getDate() + daysToAdd);
            } else {
                // Dias √∫teis: pula s√°bados, domingos e feriados
                while (addedDays < absDays) {
                    currentDate.setDate(currentDate.getDate() + step);
                    if (isDiaUtil(currentDate)) {
                        addedDays++;
                    }
                }
            }

            const formatted = formatDateBR(currentDate);
            document.getElementById('result-add-date').textContent = formatted.curta;
            document.getElementById('result-add-detail').textContent = formatted.longa;
            document.getElementById('result-add').classList.remove('hidden');

            // Exibe feriados no per√≠odo (apenas feriados em dias √∫teis, ou seja, excluindo fim de semana)
            const feriados = getFeriadosNoPeriodo(startDate, currentDate)
                .filter(f => { const dow = f.data.getDay(); return dow !== 0 && dow !== 6; });
            renderFeriados('result-add-feriados', 'result-add-feriados-list', feriados);
        }

        // ==========================================
        // ABA 2: Diferen√ßa de Datas
        // ==========================================
        function calculateDateDifference() {
            const date1Str = document.getElementById('diff-date-1').value;
            const date2Str = document.getElementById('diff-date-2').value;

            if (!date1Str || !date2Str) return;

            let d1 = parseDate(date1Str);
            let d2 = parseDate(date2Str);

            // Garante que d1 seja sempre a data mais antiga
            if (d1 > d2) { const temp = d1; d1 = d2; d2 = temp; }

            // C√°lculo Dias Corridos
            const diffTime = Math.abs(d2 - d1);
            const diffCorridos = Math.round(diffTime / (1000 * 60 * 60 * 24));

            // C√°lculo Dias √öteis (exclui fim de semana e feriados)
            let diffUteis = 0;
            let current = new Date(d1);
            while (current < d2) {
                current.setDate(current.getDate() + 1);
                if (isDiaUtil(current)) {
                    diffUteis++;
                }
            }

            document.getElementById('result-diff-corridos').textContent = diffCorridos;
            document.getElementById('result-diff-uteis').textContent = diffUteis;
            document.getElementById('result-diff').classList.remove('hidden');

            // Exibe feriados em dias √∫teis no per√≠odo
            const feriados = getFeriadosNoPeriodo(d1, d2)
                .filter(f => { const dow = f.data.getDay(); return dow !== 0 && dow !== 6; });
            renderFeriados('result-diff-feriados', 'result-diff-feriados-list', feriados);
        }
    </script>
</body>

</html>